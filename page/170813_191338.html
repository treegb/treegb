<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../css/css_coreNote_001.css">
<link rel="shortcut icon" href="../img/treegb_icon.ico">
<title>grub.cfg on multi ISO bootable disk (partition) backup</title>
</head>

<style type="text/css">
</style>

<body>

<header>
    <h1>&lt;grub.cfg&gt; on multi ISO bootable disk (partition) backup</h1>
    <div class="subtitle">
        <p>170813_191338</p>
        <p><iframe src="./170721_194059.html" class="ifrmRefDest"></iframe></p>
    </div>
</header>

<section class="section1" id="toc">
    <h2><iframe class="ifrmRefDest" src="170723_110344.html"></iframe></h2>

    <div class="foldableContent">
        <ul>
            <li><strong class="lihed"><a href="#d170817_113658">Nav.</a></strong></li>
            <li><strong class="lihed"><a href="#d170817_113822">&lt;grub.cfg&gt; on multi ISO bootable disk (partition) backup</a></strong>.</li>
        </ul>
    </div>
</section>

<section class="section1">
    <h2>&lt;grub.cfg&gt; on multi ISO bootable disk (partition) backup<a class="ancrDest" id="d170817_113822"></a></h2>

    <div class="foldableContent">
        <ul>
            <li>
                <p><strong class="lihed">This is <b class="code1">/boot/grub/grub.cfg</b> file on multi ISO bootable hard disk (partition)</strong> : Which can boot to multiple ISO with this [script/config], offer multiple menuentry to choose. And backup here in case I lost those file.</p>
                <div class="cbk1">
                    <p class="pre">
# begin here: https://wiki.archlinux.org/index.php/Multiboot_USB_drive
# good reference: https://wiki.archlinux.org/index.php/GRUB
# minimal config: https://blog.hartwork.org/?p=1807

# grub-install --no-floppy --boot-directory=/mnt/t1/boot/ /dev/sdb

# https://wiki.archlinux.org/index.php/GRUB#Enable_debug_messages
# set pager=1
# set debug=1

# ** Set fix resolution. You might want to change this if you change screen.
set gfxmode=1024x768
# ** Also people suggest adding this but I'm not sure.
set gfxpayload=keep

# ** Remember, if you use <quick boot selection menu> (some motherboard use F8 key) in boot time, <hd0> exceptionally always mean seleted device, not first detected device, disregarding what sequence this device it actually is in [BIOS // UEFI] order. The rest of device remain normal, will follow the normal sequence.
set root=(hd0,msdos1)
# ** Not sure if adding this will cause unintended problem, but it seems fine.
set prefix=($root)/boot/grub
# ** Default selected menuentry. Count from 0.
set default=0
set timeout=21

# ** This can used to set root too. Also can used to search files and set path to a new variable name.
# search --no-floppy --fs-uuid --set=root d7540d3d-066b-40c8-8875-92026d483cdc


insmod part_msdos
insmod iso9660

if loadfont /boot/grub/fonts/unicode.pf2 ; then
    insmod all_video
    insmod gfxterm
    insmod png
    insmod jpeg
    set gfxpayload=keep
    terminal_output gfxterm
fi

if background_image /boot/grub/light-dot.jpg; then
  set color_normal=white/black
  set color_highlight=black/white
else
  set menu_color_normal=cyan/blue
  set menu_color_highlight=white/blue
fi


# ** Method 1, recursive generate menuentry.
menuentry '##### ** Method 1, recursive generate menuentry. #####' { nop }


insmod regexp

for isofile in /iso/debian-live-*-amd64-*.iso; do
    regexp --set=isoname "/iso/(.*)" "$isofile"
    submenu "$isoname ->" "$isofile" {
        iso_path="$2"
        loopback loop "$iso_path"

        menuentry 'Live (amd64)' {
            bootoptions="findiso=$iso_path boot=live components quiet splash"
            linux (loop)/live/vmlinuz-*-amd64 $bootoptions
            initrd (loop)/live/initrd.img-*-amd64
        }

        menuentry 'Live (amd64 failsafe)' {
            bootoptions="findiso=$iso_path boot=live components memtest noapic noapm nodma nomce nolapic nomodeset nosmp nosplash vga=normal"
            linux (loop)/live/vmlinuz-*-amd64 $bootoptions
            initrd (loop)/live/initrd.img-*-amd64
        }
        
        # ** Inside vmlinuz and initrd won't detect ISO file as expect so Debian Installer won't work.
        #menuentry "Debian Installer not work as expect" {
        #    bootoptions="findiso=$iso_path"
        #    linux  (loop)/d-i/vmlinuz $bootoptions
        #    initrd (loop)/d-i/initrd.gz
        #}
    }
done


# ** Method 2, "jump" (configfile) to second grub.cfg inside ISO.
menuentry '##### ** Method 2, "jump" (configfile) to second grub.cfg inside ISO and pass control. #####' { nop }


menuentry "Debian Stretch 9.0.1, Live, configfile, kernel 4.9.0-3-amd64" {
    set root=(hd0,msdos1)
    iso_path='/iso/debian-live-9.0.1-amd64-gnome.iso'
    export iso_path
    # ** Don't know why author add this line, it seems to be useless.
    #search --set=root --file $iso_path
    loopback loop $iso_path
    root=(loop)
    configfile /boot/grub/grub.cfg
    # ** Don't know what is this for because it is not harm to remove it. Maybe this is a fallback design to release loop if configfile not work.
    loopback --delete loop
    # ** Inside vmlinuz and initrd won't detect ISO file as expect so Debian Installer won't work.
}


# ** Method 3, full [manual/custom] setting with each ISO.
menuentry '##### ** Method 3, full [manual/custom] setting with each ISO. #####' { nop }


menuentry "Debian Stretch 9.0.1, Live, kernel 4.9.0-3-amd64" {
    set root=(hd0,msdos1)
    iso_path='/iso/debian-live-9.0.1-amd64-gnome.iso'
    loopback loop $iso_path
    bootoptions="findiso=$iso_path boot=live components quiet splash"
    linux (loop)/live/vmlinuz-4.9.0-3-amd64 $bootoptions
    initrd (loop)/live/initrd.img-4.9.0-3-amd64
}

# ** Inside vmlinuz and initrd won't detect ISO file as expect so Debian Installer won't work.
#menuentry "Debian Installer not work as expect" {
#    set root=(hd0,msdos1)
#    iso_path='/iso/debian-live-9.0.1-amd64-gnome.iso'
#    loopback loop $iso_path
#    bootoptions="findiso=$iso_path"
#    linux  (loop)/d-i/vmlinuz $bootoptions
#    initrd (loop)/d-i/initrd.gz
#}

# ** Always use external kernel (manual download from Debian mirrors) to run <Debian Installer>, becuase kernel inside ISO seems can't fully function to get outside ISO as some boost function, and can't install properly (?).
menuentry "Debian Stretch 9.0.1, Debian Installer, external kernel" {
    set root=(hd0,msdos1)
    iso_path='/iso/debian-live-9.0.1-amd64-gnome.iso'
    # ** In this case, even don't offer <findiso> to kernel it still works. But I'm not sure if it is legit.
    bootoptions="findiso=$iso_path"
    linux  /vmlinuz_initrd/vmlinuz $bootoptions
    initrd /vmlinuz_initrd/initrd.gz
}


menuentry '#####' { nop }

menuentry 'REBOOT' { reboot }

menuentry 'SHUTDOWN' { halt }
</p>
                </div>
            </li>
        </ul>
    </div>
</section>

<section class="section1">
    <h2>Nav<a class="ancrDest" id="d170817_113658"></a></h2>

    <div class="foldableContent">
        <iframe class="ifrmRefDest" src="170721_194101.html"></iframe>
        <ul>
            <li><strong class="lihed"><a href="170721_170002.html">Debian installation.</a></strong></li>
        </ul>
    </div>
</section>



<script type="text/javascript" src="../js/js_coreNote_001.js"></script>

</body>
</html>
